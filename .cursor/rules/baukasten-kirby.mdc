---
description:
globs:
alwaysApply: true
---
# Baukasten Kirby CMS Rules

You are an expert in Kirby CMS with a focus on headless implementations.

## Key Principles

- Kirby is used as a headless CMS in this project
- The CMS generates JSON files consumed by an Astro frontend
- Most logic is implemented in plugins (located in site/plugins/ directory)
- The CMS is hosted on different hosting setups as defined in environment variables

## Project Structure

The project follows this structure:
```
content/             - Content folders for each section
kirby/               - Core Kirby CMS files (should not be modified)
site/
  blueprints/        - Structure definitions for content
    blocks/          - Block-based content definitions
    fields/          - Custom field definitions
    files/           - File upload definitions
    pages/           - Page type definitions
  config/            - Configuration files for Kirby
  controllers/       - PHP controllers for templates
  languages/         - Language definitions
  models/            - Custom page models
  plugins/           - Custom plugins extending functionality
    baukasten-blocks/          - Block definitions for Baukasten
    baukasten-layouts/         - Layout definitions
    baukasten-programmable-blueprints/ - Dynamic blueprint generation
    baukasten-kirby-routes/    - Custom API routes
    kirby-thumbhash/           - Image processing plugin
  templates/         - PHP templates for rendering
public/              - Publicly accessible files
  media/             - Uploaded files and media
  panel/             - Kirby Panel (admin interface)
storage/             - Cache and session storage
vendor/              - Composer dependencies
```

## Integration Points

- The frontend connects to Kirby via the URL defined in KIRBY_URL environment variable
- Data is consumed through JSON endpoints (e.g., '/global.json')
- The CMS provides structured content that maps to the block-based component system in the Astro frontend
- The Kirby API routes are defined in plugins/baukasten-kirby-routes/

## Content Structure

- Content is organized in hierarchical page structures
- Each page can have multiple language versions
- Page content is structured using blocks
- Blocks are defined in site/blueprints/blocks/
- Content is exposed via JSON endpoints for the Astro frontend

## Key Features

- Multi-language support with language codes and default language settings
- Content blocks that map to corresponding Astro components
- Configuration options exposed through the global.json endpoint
- Robust media handling with image processing capabilities
- Thumbhash generation for image placeholders

## Development Workflow

- Kirby provides the content structure and data
- Changes to the CMS structure may require corresponding updates to the Astro frontend
- The preview functionality in Astro (/preview/) allows viewing content changes without deployment
- Panel interface for content editors at /panel

## Plugin Structure

- Custom plugins extend Kirby's functionality
- baukasten-blocks - Provides block-based content definitions
- baukasten-layouts - Provides layout components
- baukasten-kirby-routes - Creates API endpoints for Astro
- baukasten-programmable-blueprints - Dynamic blueprint generation
- kirby-thumbhash - Image processing and optimization

## Best Practices

- Follow Kirby's coding standards and documentation
- Ensure JSON endpoints are well-structured and documented
- Handle multilingual content appropriately
- Implement proper error handling and validation
- Use Kirby's blueprints for structured content editing
- Consider caching strategies for improved performance
- When modifying blueprints, update corresponding Astro components
- Check latest Kirby documentation at https://getkirby.com/docs
- Follow the convention over configuration approach